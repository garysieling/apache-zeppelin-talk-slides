{
  "paragraphs": [
    {
      "text": "sh\n\nls /data/household/demo/",
      "user": "anonymous",
      "dateUpdated": "2019-08-20 00:29:35.936",
      "config": {
        "colWidth": 12.0,
        "fontSize": 9.0,
        "enabled": true,
        "results": {},
        "editorSetting": {
          "language": "scala",
          "editOnDblClick": false,
          "completionKey": "TAB",
          "completionSupport": true
        },
        "editorMode": "ace/mode/scala"
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "TEXT",
            "data": "after-0\nafter-0.gif\nafter-1\nafter-2\nafter-3\nafter-4\nafter-5\nafter-6\nafter-7\nafter-8\nbefore\n"
          }
        ]
      },
      "apps": [],
      "jobName": "paragraph_1565450558552_-742234857",
      "id": "20190810-152238_726715918",
      "dateCreated": "2019-08-10 15:22:38.553",
      "dateStarted": "2019-08-19 16:58:25.618",
      "dateFinished": "2019-08-19 16:58:29.230",
      "status": "FINISHED",
      "progressUpdateIntervalMs": 500
    },
    {
      "text": "%python\n\nfrom mxnet.gluon.model_zoo.vision import mobilenet_v2_1_0\nfrom mxnet import init\nfrom mxnet import image\nimport matplotlib.pyplot as plt\nimport os\nfrom mxnet import nd\nimport mxnet\nimport cv2\n\nfrom mxnet.gluon.model_zoo.vision import resnet50_v1\n\nprint(\"Supported labels: \" + str([a for a in category_to_idx.keys()]))\n\n\ndef get_label_and_prod(out):\n  labels \u003d [a for a in category_to_idx.keys()]\n  pred \u003d int(nd.argmax(out, axis\u003d1).asscalar())\n  maxval \u003d nd.max(out, axis\u003d1).asscalar()\n\n  return pred, labels[pred], maxval\n\ndef predict_class(net, fname, epoch):\n  with open(\"/data/household/demo/before/\" + fname, \u0027rb\u0027) as f:\n    img \u003d image.imdecode(f.read())\n    data, _ \u003d transform(img, -1, test_augs)\n    \n    data \u003d data.expand_dims(axis\u003d0)\n    data \u003d color_normalize(data/255,\n      mean \u003d nd.array([0.485, 0.456, 0.406]).reshape((1,3,1,1)),\n      std \u003d nd.array([0.229, 0.224, 0.225]).reshape((1,3,1,1)))\n    \n    out \u003d net(data.as_in_context(mxnet.cpu()))\n    #print(fname + \" \" + str(out))\n    pred, label, maxval \u003d get_label_and_prod(out)\n\n    if maxval \u003e 2:\n      #img \u003d cv2.putText(img.asnumpy(), fname.split(\"-\")[1], (5, 40), cv2.FONT_HERSHEY_SIMPLEX, 1.25, (255, 255, 255, 255), 2)\n      img \u003d cv2.putText(img.asnumpy(), label, (5, 40), cv2.FONT_HERSHEY_SIMPLEX, 1.25, (255, 255, 255, 255), 2)\n      #img \u003d cv2.putText(img, str(maxval), (5, 130), cv2.FONT_HERSHEY_SIMPLEX, 1.25, (255, 255, 255, 255), 2)\n    else:\n      img \u003d img.asnumpy()\n    \n    cv2.imwrite(\"/data/household/demo/after-\" + str(epoch) + \"/\" + fname, img)\n\nfor epoch in range(12, 13):\n  max_checkpoint \u003d 0\n\n  train_map \u003d {\u0027breaker_box\u0027: 0, \u0027furnace\u0027: 1, \u0027hot_water_tank\u0027: 2, \u0027oil_tank\u0027: 3, \u0027pillar\u0027: 4, \u0027smoke_detector\u0027: 5, \u0027stairs\u0027: 6, \u0027sump_pump\u0027: 7, \u0027wall\u0027: 8, \u0027washer\u0027: 9, \u0027water_softener\u0027: 10}\n\n\n  #for epoch in range(epochs, epochs):\n  print(\"Epoch: \" + str(epoch))\n  \n  os.system(\"mkdir -p /data/household/demo/after-\" + str(epoch))\n\n  pretrained_net \u003d resnet50_v1(pretrained\u003dTrue)\n \n  epoch_net \u003d resnet50_v1(classes\u003dlen(train_map))\n  epoch_net.features \u003d pretrained_net.features\n  epoch_net.output.initialize(init.Xavier())\n \n  #epoch_net.collect_params().load(\u0027/data/checkpoints/%d-%d.params\u0027 % (epoch, max_checkpoint))\n  epoch_net.load_parameters(\u0027/data/checkpoints/%d.params\u0027 % (epoch))\n  \n  for filename in sorted(os.listdir(\"/data/household/demo/before/\")):\n    if filename.endswith(\".jpg\"):\n      predict_class(epoch_net, filename, epoch)",
      "user": "anonymous",
      "dateUpdated": "2019-08-20 01:19:54.808",
      "config": {
        "colWidth": 12.0,
        "fontSize": 9.0,
        "enabled": true,
        "results": {},
        "editorSetting": {
          "language": "python",
          "editOnDblClick": false,
          "completionKey": "TAB",
          "completionSupport": true
        },
        "editorMode": "ace/mode/python"
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "ERROR",
        "msg": [
          {
            "type": "TEXT",
            "data": "Traceback (most recent call last):\n  File \"/tmp/zeppelin_python-6532584236064900851.py\", line 295, in \u003cmodule\u003e\n    code \u003d compile(\u0027\\n\u0027.join(final_code), \u0027\u003cstdin\u003e\u0027, \u0027exec\u0027, ast.PyCF_ONLY_AST, 1)\n  File \"\u003cstdin\u003e\", line 11\n    val category_to_idx \u003d {\u0027breaker_box\u0027: 0, \u0027furnace\u0027: 1, \u0027hot_water_tank\u0027: 2, \u0027oil_tank\u0027: 3, \u0027pillar\u0027: 4, \u0027smoke_detector\u0027: 5, \u0027stairs\u0027: 6, \u0027sump_pump\u0027: 7, \u0027wall\u0027: 8, \u0027washer\u0027: 9, \u0027water_softener\u0027: 10}\n                      ^\nSyntaxError: invalid syntax\n"
          }
        ]
      },
      "apps": [],
      "jobName": "paragraph_1565450545483_-1403815694",
      "id": "20190810-152225_1351832587",
      "dateCreated": "2019-08-10 15:22:25.483",
      "dateStarted": "2019-08-20 01:19:47.181",
      "dateFinished": "2019-08-20 01:19:47.249",
      "status": "ERROR",
      "progressUpdateIntervalMs": 500
    },
    {
      "text": "%spark\nprint(\"%html \")\n\ndef showImage(file: java.io.File) \u003d {\n  import java.io._\n  import java.util._\n  val fis \u003d new FileInputStream(file)\n \n  val data \u003d Array.fill[Byte](file.length.toInt)(0)\n  fis.read(data)\n  fis.close\n \n  val encoded_string \u003d Base64.getEncoder.encodeToString(data)\n  print(\"\u003cimg src\u003d\u0027data:image/jpeg;base64,\" + encoded_string + \"\u0027 style\u003d\u0027float:left;padding:5px;max-height:100px\u0027 /\u003e\")\n}\n\ndef showImages(path: String, num: Int) \u003d {\n  import scala.collection.JavaConversions._\n  import java.util.Base64\n  import java.nio.charset.StandardCharsets\n\n  println(\"\u003ch4\u003eImages\u003c/h4\u003e\")\n  print(\"\u003ch5\u003e\" + path + \"\u003c/h5\u003e\")\n  val files \u003d (new java.io.File(path)).listFiles\n  scala.util.Random.shuffle(files.toList).take(num).map(showImage)\n  \n  {}\n}\n\nval rootPath \u003d \"/data/household/train/\"\nval select \u003d z.select(\"Tag\", (new java.io.File(rootPath).listFiles).map((f) \u003d\u003e (f.toString, f.toString)))\n\nshowImages(select.toString + \"/\", 25)",
      "user": "anonymous",
      "dateUpdated": "2019-08-10 15:21:17.005",
      "config": {
        "colWidth": 12.0,
        "fontSize": 9.0,
        "enabled": true,
        "results": {},
        "editorSetting": {
          "language": "scala",
          "editOnDblClick": false,
          "completionKey": "TAB",
          "completionSupport": true
        },
        "editorMode": "ace/mode/scala"
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "apps": [],
      "jobName": "paragraph_1565450447478_-2105497649",
      "id": "20190810-152047_1906571058",
      "dateCreated": "2019-08-10 15:20:47.478",
      "status": "READY",
      "progressUpdateIntervalMs": 500
    },
    {
      "text": "%spark\n\n//print(\"%html \")\nimport org.apache.mxnet._\nimport org.kohsuke.args4j.{CmdLineParser, Option}\nimport org.slf4j.LoggerFactory\nimport org.apache.mxnet.infer.{Classifier, ImageClassifier}\nimport scala.collection.JavaConverters._\nimport java.io.File\nimport java.awt.image.BufferedImage\nimport scala.collection.mutable.ListBuffer\n\nvar context \u003d Context.cpu()\n\ndef showImage(file: java.io.File, height: Int) \u003d {\n  import java.io._\n  import java.util._\n  val fis \u003d new FileInputStream(file)\n \n  val data \u003d Array.fill[Byte](file.length.toInt)(0)\n  fis.read(data)\n  fis.close\n \n  val encoded_string \u003d Base64.getEncoder.encodeToString(data)\n  print(\"\u003cimg src\u003d\u0027data:image/jpeg;base64,\" + encoded_string + \"\u0027 style\u003d\u0027float:left;padding:5px;max-height:\" + height + \"px\u0027 /\u003e\")\n}\n\nvar inputImageDir \u003d \"/data/household/demo/before/\"\n  def generateBatches(inputImageDirPath: String, batchSize: Int \u003d 100): List[List[String]] \u003d {\n    val dir \u003d new File(inputImageDirPath)\n    require(dir.exists \u0026\u0026 dir.isDirectory,\n      \"input image directory: %s not found\".format(inputImageDirPath))\n    val output \u003d ListBuffer[List[String]]()\n    var batch \u003d ListBuffer[String]()\n    for (imgFile: File \u003c- dir.listFiles()){\n      batch +\u003d imgFile.getPath\n      if (batch.length \u003d\u003d batchSize) {\n        output +\u003d batch.toList\n        batch \u003d ListBuffer[String]()\n      }\n    }\n    if (batch.length \u003e 0) {\n      output +\u003d batch.toList\n    }\n    output.toList\n  }\n  \n   def runInferenceOnBatchOfImage(modelPathPrefix: String, \n                                 context: Array[Context]):\nIndexedSeq[IndexedSeq[(String, Float)]] \u003d {\n    ResourceScope.using() {\n      val dType \u003d DType.Float32\n      val inputShape \u003d Shape(1, 3, 224, 224)\n\n      val inputDescriptor \u003d IndexedSeq(DataDesc(\"data\", inputShape, dType, \"NCHW\"))\n\n      // Create object of ImageClassifier class\n      val imgClassifier: ImageClassifier \u003d new\n          ImageClassifier(modelPathPrefix, inputDescriptor, context)\n\n      // Loading batch of images from the directory path\n      val batchFiles \u003d generateBatches(inputImageDir, 20)\n      var outputList \u003d IndexedSeq[IndexedSeq[(String, Float)]]()\n\n      for (batchFile \u003c- batchFiles) {\n        val imgList \u003d ImageClassifier.loadInputBatch(batchFile)\n        // Running inference on batch of images loaded in previous step\n        outputList ++\u003d imgClassifier.classifyImageBatch(imgList, Some(5))\n      }\n\n      outputList\n    }\n}\n  \n  \n\n  def runInferenceOnSingleImage(modelPathPrefix: String, inputImagePath: String,\n                                context: Array[Context]):\n  IndexedSeq[IndexedSeq[(String, Float)]] \u003d {\n    ResourceScope.using() {\n      val dType \u003d DType.Float32\n      val inputShape \u003d Shape(1, 3, 224, 224)\n\n      val inputDescriptor \u003d IndexedSeq(DataDesc(\"data\", inputShape, dType, \"NCHW\"))\n\n      // Create object of ImageClassifier class\n      val imgClassifier: ImageClassifier \u003d new\n          ImageClassifier(modelPathPrefix, inputDescriptor, context)\n\n      // Loading single image from file and getting BufferedImage\n      val img \u003d ImageClassifier.loadImageFromFile(inputImagePath)\n\n      // Running inference on single image\n      val output \u003d imgClassifier.classifyImage(img, Some(5))\n      output\n    }\n  }\n\n//val before \u003d z.select(\"Tag\", (new java.io.File(\"/data/household/demo/before\").listFiles).map((f) \u003d\u003e (f.toString, f.toString)))\n//val checkpoint \u003d z.select(\"Checkpoint\", (new java.io.File(\"/data/checkpoints\").listFiles).sorted.map((f) \u003d\u003e (f.toString, f.toString)))\n\n//if (before.toString !\u003d \"\" \u0026\u0026 checkpoint.toString !\u003d \"\") {\n//    runInferenceOnSingleImage(checkpoint.toString, before.toString, Array(context))\n//}\n//import org.apache.mxnet._\n//val images \u003d (new java.io.File(\"/data/household/demo/before\")).listFiles\n// data/checkpoints\nval tags \u003d \n  Seq((\"0\", \"breaker_box\"),\n   (\"1\", \"furnace\"),\n   (\"2\", \"hot_water_tank\"),\n   (\"3\", \"oil_tank\"),\n   (\"4\", \"pillar\"),\n   (\"5\", \"smoke_detector\"),\n   (\"6\", \"stairs\"),\n   (\"7\", \"sump_pump\"),\n   (\"8\", \"wall\"),\n   (\"9\", \"washer\"),\n   (\"10\", \"water_softener\"))\n\n(new java.io.File(\"/\")).listFiles.take(1).map(\n    (img: java.io.File) \u003d\u003e {\n        //showImage(img, 50)\n        z.checkbox(img.toString, tags)    \n    }\n)\n\n\n//print(\"\u003cul\u003e\")\n/*images.map(\n    (image) \u003d\u003e { \n       z.checkbox(\"a\")   \n    }\n)*/\n//print(\"\u003c/ul\u003e\")\n\n",
      "user": "anonymous",
      "dateUpdated": "2019-08-20 00:43:08.608",
      "config": {
        "colWidth": 12.0,
        "fontSize": 9.0,
        "enabled": true,
        "results": {},
        "editorSetting": {
          "language": "scala",
          "editOnDblClick": false,
          "completionKey": "TAB",
          "completionSupport": true
        },
        "editorMode": "ace/mode/scala",
        "runOnSelectionChange": true
      },
      "settings": {
        "params": {
          "Tag": "/data/household/demo/before/frames-0575.jpg",
          "Checkpoint": "/data/checkpoints/0-1400.params",
          "fruit": [
            "banana",
            "orange",
            "apple"
          ],
          "/data/checkpoints/8.params": [
            "0",
            "1",
            "2",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10"
          ],
          "/data/checkpoints/9-100.params": [
            "0",
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10"
          ],
          "/data/checkpoints/3-400.params": [
            "0",
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10"
          ],
          "/data/checkpoints/29-300.params": [
            "0",
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10"
          ],
          "/data/checkpoints/8-400.params": [
            "0",
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10"
          ],
          "/data/checkpoints/0-1900.params": [
            "0",
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10"
          ],
          "/data/checkpoints/1-500.params": [
            "0",
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10"
          ],
          "/data/checkpoints/5-300.params": [
            "0",
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10"
          ],
          "/data/checkpoints/12-200.params": [
            "0",
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10"
          ],
          "/data/checkpoints/14-0.params": [
            "0",
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10"
          ]
        },
        "forms": {
          "/data/checkpoints/8.params": {
            "type": "CheckBox",
            "options": [
              {
                "value": "0",
                "displayName": "breaker_box"
              },
              {
                "value": "1",
                "displayName": "furnace"
              },
              {
                "value": "2",
                "displayName": "hot_water_tank"
              },
              {
                "value": "3",
                "displayName": "oil_tank"
              },
              {
                "value": "4",
                "displayName": "pillar"
              },
              {
                "value": "5",
                "displayName": "smoke_detector"
              },
              {
                "value": "6",
                "displayName": "stairs"
              },
              {
                "value": "7",
                "displayName": "sump_pump"
              },
              {
                "value": "8",
                "displayName": "wall"
              },
              {
                "value": "9",
                "displayName": "washer"
              },
              {
                "value": "10",
                "displayName": "water_softener"
              }
            ],
            "name": "/data/checkpoints/8.params",
            "displayName": "/data/checkpoints/8.params",
            "defaultValue": [
              "0",
              "1",
              "2",
              "3",
              "4",
              "5",
              "6",
              "7",
              "8",
              "9",
              "10"
            ],
            "hidden": false
          }
        }
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "TEXT",
            "data": "import org.apache.mxnet._\nimport org.kohsuke.args4j.{CmdLineParser, Option}\nimport org.slf4j.LoggerFactory\nimport org.apache.mxnet.infer.{Classifier, ImageClassifier}\nimport scala.collection.JavaConverters._\nimport java.io.File\nimport java.awt.image.BufferedImage\nimport scala.collection.mutable.ListBuffer\ncontext: org.apache.mxnet.Context \u003d cpu(0)\nshowImage: (file: java.io.File, height: Int)Unit\ninputImageDir: String \u003d /data/household/demo/before/\ngenerateBatches: (inputImageDirPath: String, batchSize: Int)List[List[String]]\nrunInferenceOnBatchOfImage: (modelPathPrefix: String, context: Array[org.apache.mxnet.Context])IndexedSeq[IndexedSeq[(String, Float)]]\nrunInferenceOnSingleImage: (modelPathPrefix: String, inputImagePath: String, context: Array[org.apache.mxnet.Context])IndexedSeq[In..."
          }
        ]
      },
      "apps": [],
      "jobName": "paragraph_1566233981625_-1436247447",
      "id": "20190819-165941_1781723274",
      "dateCreated": "2019-08-19 16:59:41.625",
      "dateStarted": "2019-08-20 00:42:48.248",
      "dateFinished": "2019-08-20 00:42:50.315",
      "status": "FINISHED",
      "progressUpdateIntervalMs": 500
    },
    {
      "text": "%spark\n\nprint(\"%html \")\nimport org.apache.mxnet._\nimport org.kohsuke.args4j.{CmdLineParser, Option}\nimport org.slf4j.LoggerFactory\nimport org.apache.mxnet.infer.{Classifier, ImageClassifier}\nimport scala.collection.JavaConverters._\nimport java.io.File\nimport java.awt.image.BufferedImage\nimport scala.collection.mutable.ListBuffer\n\nvar context \u003d Context.cpu()\n\ndef showImage(file: java.io.File, height: Int) \u003d {\n  import java.io._\n  import java.util._\n  val fis \u003d new FileInputStream(file)\n \n  val data \u003d Array.fill[Byte](file.length.toInt)(0)\n  fis.read(data)\n  fis.close\n \n  val encoded_string \u003d Base64.getEncoder.encodeToString(data)\n  print(\"\u003cimg src\u003d\u0027data:image/jpeg;base64,\" + encoded_string + \"\u0027 style\u003d\u0027float:left;padding:5px;max-height:\" + height + \"px\u0027 /\u003e\")\n}\n\nvar inputImageDir \u003d \"/data/household/demo/before/\"\n  def generateBatches(inputImageDirPath: String, batchSize: Int \u003d 100): List[List[String]] \u003d {\n    val dir \u003d new File(inputImageDirPath)\n    require(dir.exists \u0026\u0026 dir.isDirectory,\n      \"input image directory: %s not found\".format(inputImageDirPath))\n    val output \u003d ListBuffer[List[String]]()\n    var batch \u003d ListBuffer[String]()\n    for (imgFile: File \u003c- dir.listFiles()){\n      batch +\u003d imgFile.getPath\n      if (batch.length \u003d\u003d batchSize) {\n        output +\u003d batch.toList\n        batch \u003d ListBuffer[String]()\n      }\n    }\n    if (batch.length \u003e 0) {\n      output +\u003d batch.toList\n    }\n    output.toList\n  }\n  \n   def runInferenceOnBatchOfImage(modelPathPrefix: String, \n                                 context: Array[Context]):\nIndexedSeq[IndexedSeq[(String, Float)]] \u003d {\n    ResourceScope.using() {\n      val dType \u003d DType.Float32\n      val inputShape \u003d Shape(1, 3, 224, 224)\n\n      val inputDescriptor \u003d IndexedSeq(DataDesc(\"data\", inputShape, dType, \"NCHW\"))\n\n      // Create object of ImageClassifier class\n      val imgClassifier: ImageClassifier \u003d new\n          ImageClassifier(modelPathPrefix, inputDescriptor, context)\n\n      // Loading batch of images from the directory path\n      val batchFiles \u003d generateBatches(inputImageDir, 20)\n      var outputList \u003d IndexedSeq[IndexedSeq[(String, Float)]]()\n\n      for (batchFile \u003c- batchFiles) {\n        val imgList \u003d ImageClassifier.loadInputBatch(batchFile)\n        // Running inference on batch of images loaded in previous step\n        outputList ++\u003d imgClassifier.classifyImageBatch(imgList, Some(5))\n      }\n\n      outputList\n    }\n}\n  \n  \n\n  def runInferenceOnSingleImage(modelPathPrefix: String, inputImagePath: String,\n                                context: Array[Context]):\n  IndexedSeq[IndexedSeq[(String, Float)]] \u003d {\n    ResourceScope.using() {\n      val dType \u003d DType.Float32\n      val inputShape \u003d Shape(1, 3, 224, 224)\n\n      val inputDescriptor \u003d IndexedSeq(DataDesc(\"data\", inputShape, dType, \"NCHW\"))\n\n      // Create object of ImageClassifier class\n      val imgClassifier: ImageClassifier \u003d new\n          ImageClassifier(modelPathPrefix, inputDescriptor, context)\n\n      // Loading single image from file and getting BufferedImage\n      val img \u003d ImageClassifier.loadImageFromFile(inputImagePath)\n\n      // Running inference on single image\n      val output \u003d imgClassifier.classifyImage(img, Some(5))\n      output\n    }\n  }\n\n//val before \u003d z.select(\"Tag\", (new java.io.File(\"/data/household/demo/before\").listFiles).map((f) \u003d\u003e (f.toString, f.toString)))\n//val checkpoint \u003d z.select(\"Checkpoint\", (new java.io.File(\"/data/checkpoints\").listFiles).sorted.map((f) \u003d\u003e (f.toString, f.toString)))\n\n//if (before.toString !\u003d \"\" \u0026\u0026 checkpoint.toString !\u003d \"\") {\n//    runInferenceOnSingleImage(checkpoint.toString, before.toString, Array(context))\n//}\n//import org.apache.mxnet._\n//val images \u003d (new java.io.File(\"/data/household/demo/before\")).listFiles\n// data/checkpoints\nval tags \u003d \n  Seq((\"0\", \"breaker_box\"),\n   (\"1\", \"furnace\"),\n   (\"2\", \"hot_water_tank\"),\n   (\"3\", \"oil_tank\"),\n   (\"4\", \"pillar\"),\n   (\"5\", \"smoke_detector\"),\n   (\"6\", \"stairs\"),\n   (\"7\", \"sump_pump\"),\n   (\"8\", \"wall\"),\n   (\"9\", \"washer\"),\n   (\"10\", \"water_softener\"))\n\nval src \u003d \"/data/tagged.csv\"\nval lines \u003d scala.io.Source.fromFile(src).getLines.map(\n    _.split(\",\")\n).toList\n\nlines.map(println)\n\n\nprint(\"\u003cform\u003e\")\nval img \u003d new java.io.File(\"/data/household/demo/before\").listFiles.take(1).head\nprint(\"\u003cdiv\u003e\")\nprint(img.toString + \" \u003cbr /\u003e\")\n\nshowImage(img, 200)\nprint(\"\u003cdiv\u003e\")\nz.checkbox(img.toString, tags)\n/*tags.map(\n    (tag) \u003d\u003e {\n        //print(\"\u003cinput type\u003d\\\"checkbox\\\" checked name\u003d\\\"\" + img.toString + \" \\\" value\u003d\\\"\" + tag._1 + \"\\\"\u003e\" + tag._2 + \" \u003cbr /\u003e\")\n        \n    }    \n)*/\nprint(\"\u003c/div\u003e\")\nprint(\"\u003cbr /\u003e\")\n\nval accepted \u003d z.checkbox(img.toString + \"_accepted\", Seq(), Seq((\"yes\", \"yes\")))\n\n//z.checkbox(img.toString, tags)    \n/*print(\"\u003c/div\u003e\")\n\nprint(\"\u003c/form\u003e\")\n        \nval output \u003d (lines.map(\n    _.mkString(\",\")\n).mkString(\"\\n\")) + (\n  if (accepted \u003d\u003d \"yes\") {\n    \"\\nx,y\\n\"\n  } else {\n      \"\"\n  }\n)*/\n\n//import java.io.PrintWriter\n//new PrintWriter(src) { write(output); close }\n\n\n//print(\"\u003cul\u003e\")\n/*images.map(\n    (image) \u003d\u003e { \n       z.checkbox(\"a\")   \n    }\n)*/\n//print(\"\u003c/ul\u003e\")\n\n",
      "user": "anonymous",
      "dateUpdated": "2019-08-20 01:14:58.537",
      "config": {
        "colWidth": 12.0,
        "fontSize": 9.0,
        "enabled": true,
        "results": {},
        "editorSetting": {
          "language": "scala",
          "editOnDblClick": false,
          "completionKey": "TAB",
          "completionSupport": true
        },
        "editorMode": "ace/mode/scala",
        "runOnSelectionChange": true,
        "editorHide": false
      },
      "settings": {
        "params": {
          "Tag": "/data/household/demo/before/frames-0575.jpg",
          "Checkpoint": "/data/checkpoints/0-1400.params",
          "fruit": [
            "banana",
            "orange",
            "apple"
          ],
          "/data/checkpoints/8.params": [
            "0",
            "1",
            "2",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10"
          ],
          "/data/checkpoints/9-100.params": [
            "0",
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10"
          ],
          "/data/checkpoints/3-400.params": [
            "0",
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10"
          ],
          "/data/checkpoints/29-300.params": [
            "0",
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10"
          ],
          "/data/checkpoints/8-400.params": [
            "0",
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10"
          ],
          "/data/checkpoints/0-1900.params": [
            "0",
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10"
          ],
          "/data/checkpoints/1-500.params": [
            "0",
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10"
          ],
          "/data/checkpoints/5-300.params": [
            "0",
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10"
          ],
          "/data/checkpoints/12-200.params": [
            "0",
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10"
          ],
          "/data/checkpoints/14-0.params": [
            "0",
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10"
          ],
          "/data/household/demo/before/frames-0575.jpg": [
            "0",
            "1",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10"
          ],
          "/data/household/demo/before/frames-0230.jpg": [
            "0",
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10"
          ],
          "/data/household/demo/before/frames-0143.jpg": [
            "0",
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10"
          ],
          "/data/household/demo/before/frames-0139.jpg": [
            "0",
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10"
          ],
          "/data/household/demo/before/frames-0595.jpg": [
            "0",
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10"
          ],
          "/data/household/demo/before/frames-0575.jpg_accepted": [
            "yes"
          ],
          "/data/household/demo/before/frames-0230.jpg_accepted": [],
          "/data/household/demo/before/frames-0143.jpg_accepted": [],
          "/data/household/demo/before/frames-0139.jpg_accepted": [],
          "/data/household/demo/before/frames-0595.jpg_accepted": []
        },
        "forms": {
          "/data/household/demo/before/frames-0575.jpg": {
            "type": "CheckBox",
            "options": [
              {
                "value": "0",
                "displayName": "breaker_box"
              },
              {
                "value": "1",
                "displayName": "furnace"
              },
              {
                "value": "2",
                "displayName": "hot_water_tank"
              },
              {
                "value": "3",
                "displayName": "oil_tank"
              },
              {
                "value": "4",
                "displayName": "pillar"
              },
              {
                "value": "5",
                "displayName": "smoke_detector"
              },
              {
                "value": "6",
                "displayName": "stairs"
              },
              {
                "value": "7",
                "displayName": "sump_pump"
              },
              {
                "value": "8",
                "displayName": "wall"
              },
              {
                "value": "9",
                "displayName": "washer"
              },
              {
                "value": "10",
                "displayName": "water_softener"
              }
            ],
            "name": "/data/household/demo/before/frames-0575.jpg",
            "displayName": "/data/household/demo/before/frames-0575.jpg",
            "defaultValue": [
              "0",
              "1",
              "2",
              "3",
              "4",
              "5",
              "6",
              "7",
              "8",
              "9",
              "10"
            ],
            "hidden": false
          },
          "/data/household/demo/before/frames-0575.jpg_accepted": {
            "type": "CheckBox",
            "options": [
              {
                "value": "yes",
                "displayName": "yes"
              }
            ],
            "name": "/data/household/demo/before/frames-0575.jpg_accepted",
            "displayName": "/data/household/demo/before/frames-0575.jpg_accepted",
            "defaultValue": [],
            "hidden": false
          }
        }
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "HTML",
            "data": "[Ljava.lang.String;@4c665256\n\u003cform\u003e\u003cdiv\u003e/data/household/demo/before/frames-0575.jpg \u003cbr /\u003e\u003cimg src\u003d\u0027data:image/jpeg;base64,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\u003d\u0027 style\u003d\u0027float:left;padding:5px;max-height:200px\u0027 /\u003e\u003cdiv\u003e\u003c/div\u003e\u003cbr /\u003e\u003c/div\u003e\u003c/form\u003eimport org.apache.mxnet._\nimport org.kohsuke.args4j.{CmdLineParser, Option}\nimport org.slf4j.LoggerFactory\nimport org.apache.mxnet.infer.{Classifier, ImageClassifier}\nimport scala.collection.JavaConverters._\nimport java.io.File\nimport java.awt.image.BufferedImage\nimport scala.collection.mutable.ListBuffer\ncontext: org.apache.mxnet.Context \u003d cpu(0)\nshowImage: (file: java.io.File, height: Int)Unit\ninputImageDir: String \u003d /data/household/demo/before/\ngenerateBatches: (inputImageDirPath: String, batchSize: Int)List[List[String]]\nrunInferenceOnBatchOfImage: (modelPathPrefix: String, context: Array[org.apache.mxnet.Context])IndexedSeq[IndexedSeq[(String, Float)]]\nrunInferenceOnSingleImage: (modelPathPrefix: String, inputImagePath: String, context: Array[org.apache.mxnet.Context])IndexedSeq[In..."
          }
        ]
      },
      "apps": [],
      "jobName": "paragraph_1566261788399_1769782918",
      "id": "20190820-004308_43411168",
      "dateCreated": "2019-08-20 00:43:08.399",
      "dateStarted": "2019-08-20 01:14:13.583",
      "dateFinished": "2019-08-20 01:14:31.205",
      "status": "FINISHED",
      "progressUpdateIntervalMs": 500
    },
    {
      "text": "%python\n\nfrom mxnet.gluon.model_zoo.vision import mobilenet_v2_1_0\nfrom mxnet import init\nfrom mxnet import image\nimport matplotlib.pyplot as plt\nimport os\nfrom mxnet import nd\nimport mxnet\nimport cv2\n\nfrom mxnet.gluon.model_zoo.vision import resnet50_v1\n\nfrom mxnet.image import color_normalize\nfrom mxnet import image\n\neigval \u003d [55.46, 4.794, 1.148]\neigvec \u003d [[-0.5675, 0.7192, 0.4009],[-0.5808, -0.0045, -0.8140],[-0.5836, -0.6948, 0.4203]]\n\ntrain_augs \u003d [\n image.HorizontalFlipAug(0.5),\n image.LightingAug(0.5, eigval, eigvec),\n image.BrightnessJitterAug(.3),\n image.HueJitterAug(.05),\n image.ForceResizeAug((224, 224))\n]\n\ntest_augs \u003d [\n    image.ResizeAug(224),\n    image.CenterCropAug((224, 224))\n]\n\n\ndef transform(data, label, augs):\n    data \u003d data.astype(\u0027float32\u0027)\n    for aug in augs:\n        data \u003d aug(data)\n    data \u003d nd.transpose(data, (2,0,1))\n    return data, nd.array([label]).asscalar().astype(\u0027float32\u0027)\n\ncategory_to_idx \u003d {\u0027breaker_box\u0027: 0, \u0027furnace\u0027: 1, \u0027hot_water_tank\u0027: 2, \u0027oil_tank\u0027: 3, \u0027pillar\u0027: 4, \u0027smoke_detector\u0027: 5, \u0027stairs\u0027: 6, \u0027sump_pump\u0027: 7, \u0027wall\u0027: 8, \u0027washer\u0027: 9, \u0027water_softener\u0027: 10}\nprint(\"Supported labels: \" + str([a for a in category_to_idx.keys()]))\n\ndef get_label_and_prod(out):\n  labels \u003d [a for a in category_to_idx.keys()]\n  pred \u003d int(nd.argmax(out, axis\u003d1).asscalar())\n  maxval \u003d nd.max(out, axis\u003d1).asscalar()\n\n  return pred, labels[pred], maxval\n\ndef predict_class(net, fname, epoch, indexhtml):\n  with open(\"/data/household/demo/before/\" + fname, \u0027rb\u0027) as f:\n    img \u003d image.imdecode(f.read())\n    data, _ \u003d transform(img, -1, test_augs)\n    \n    data \u003d data.expand_dims(axis\u003d0)\n    data \u003d color_normalize(data/255,\n      mean \u003d nd.array([0.485, 0.456, 0.406]).reshape((1,3,1,1)),\n      std \u003d nd.array([0.229, 0.224, 0.225]).reshape((1,3,1,1)))\n    \n    out \u003d net(data.as_in_context(mxnet.cpu()))\n    #print(fname + \" \" + str(out))\n    pred, label, maxval \u003d get_label_and_prod(out)\n    print(\"\u003cp\u003e\", file\u003dindexhtml)\n    print(\"\u003cimg style\u003d\\\"height:300\\\" src\u003d\\\"file:///projects/zeppelin-talk/confusion/data/household/demo/before/\" + fname + \"\\\" /\u003e\", file\u003dindexhtml)\n    print(\"\u003cbr /\u003e\", file\u003dindexhtml)\n    #print(label, file \u003d f)\n    for k in category_to_idx.keys():\n        selected \u003d \"\"\n        if k \u003d\u003d label:\n            selected \u003d \"checked\"\n        print(\"\u003cinput type\u003d\\\"checkbox\\\" name\u003d\\\"\" + fname + \"\\\" id\u003d\\\"\" + fname + \"_\" + k + \"\\\" \" + selected + \" \\\"\u003e\u003clabel for\u003d\\\"\" + fname + \"-\" + k + \"\\\"\u003e\" + k + \"\u003c/label\u003e\", file\u003dindexhtml)\n\n        #print(k)\n        \n    print(\"\u003c/p\u003e\", file\u003dindexhtml)\n\n    #if maxval \u003e 4:\n    #  #img \u003d cv2.putText(img.asnumpy(), fname.split(\"-\")[1], (5, 40), cv2.FONT_HERSHEY_SIMPLEX, 1.25, (255, 255, 255, 255), 2)\n    #  img \u003d cv2.putText(img.asnumpy(), label, (5, 45), cv2.FONT_HERSHEY_SIMPLEX, 1.25, (255, 255, 255, 255), 2)\n    #  #img \u003d cv2.putText(img, str(maxval), (5, 130), cv2.FONT_HERSHEY_SIMPLEX, 1.25, (255, 255, 255, 255), 2)\n    #else:\n    #  img \u003d img.asnumpy()\n    \n    #cv2.imwrite(\"/data/household/demo/after-\" + str(epoch) + \"/\" + fname, img)\n\n# var checkboxes \u003d document.getElementsByTagName(\"input\")\n# for (var i \u003d 0; i \u003c checkboxes.length; i++) { \n#  if (checkboxes.item(i).checked) {\n#    console.log(checkboxes.item(i).id)\n#  }\n#}\n\nepoch \u003d 12\n\ntrain_map \u003d {\u0027breaker_box\u0027: 0, \u0027furnace\u0027: 1, \u0027hot_water_tank\u0027: 2, \u0027oil_tank\u0027: 3, \u0027pillar\u0027: 4, \u0027smoke_detector\u0027: 5, \u0027stairs\u0027: 6, \u0027sump_pump\u0027: 7, \u0027wall\u0027: 8, \u0027washer\u0027: 9, \u0027water_softener\u0027: 10}\n\nf \u003d open(\"/data/validation.csv\")\n\nprint(\"Epoch: \" + str(epoch))\n  \npretrained_net \u003d resnet50_v1(pretrained\u003dTrue)\n \nepoch_net \u003d resnet50_v1(classes\u003dlen(train_map))\nepoch_net.features \u003d pretrained_net.features\nepoch_net.output.initialize(init.Xavier())\n \nepoch_net.load_parameters(\u0027/data/checkpoints/%d.params\u0027 % (epoch))\n  \nf \u003d open(\"/data/index.html\", \"w\")\nprint(\"\u003cbody\u003e\", file\u003df)\nfor filename in sorted(os.listdir(\"/data/household/demo/before/\")):\n  if filename.endswith(\".jpg\"):\n    predict_class(epoch_net, filename, epoch, f)\n    \nprint(\"\u003c/body\u003e\", file\u003df)  \nf.close()\n",
      "user": "anonymous",
      "dateUpdated": "2019-08-20 02:41:54.785",
      "config": {
        "colWidth": 12.0,
        "fontSize": 9.0,
        "enabled": true,
        "results": {},
        "editorSetting": {
          "language": "python",
          "editOnDblClick": false,
          "completionKey": "TAB",
          "completionSupport": true
        },
        "editorMode": "ace/mode/python"
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "TEXT",
            "data": "Supported labels: [\u0027breaker_box\u0027, \u0027furnace\u0027, \u0027hot_water_tank\u0027, \u0027oil_tank\u0027, \u0027pillar\u0027, \u0027smoke_detector\u0027, \u0027stairs\u0027, \u0027sump_pump\u0027, \u0027wall\u0027, \u0027washer\u0027, \u0027water_softener\u0027]\nEpoch: 12\n"
          }
        ]
      },
      "apps": [],
      "jobName": "paragraph_1566234006572_-746479520",
      "id": "20190819-170006_1942103462",
      "dateCreated": "2019-08-19 17:00:06.572",
      "dateStarted": "2019-08-20 01:44:32.801",
      "dateFinished": "2019-08-20 01:48:01.421",
      "status": "FINISHED",
      "progressUpdateIntervalMs": 500
    },
    {
      "text": "%python\n\n#print (\"%table \")\nfrom mxnet.gluon.model_zoo.vision import mobilenet_v2_1_0\nfrom mxnet import init\nfrom mxnet import image\nimport matplotlib.pyplot as plt\nimport os\nfrom mxnet import nd\nimport mxnet\nimport cv2\n\nfrom mxnet.gluon.model_zoo.vision import resnet50_v1\n\nfrom mxnet.image import color_normalize\nfrom mxnet import image\n\neigval \u003d [55.46, 4.794, 1.148]\neigvec \u003d [[-0.5675, 0.7192, 0.4009],[-0.5808, -0.0045, -0.8140],[-0.5836, -0.6948, 0.4203]]\n\ntrain_augs \u003d [\n image.HorizontalFlipAug(0.5),\n image.LightingAug(0.5, eigval, eigvec),\n image.BrightnessJitterAug(.3),\n image.HueJitterAug(.05),\n image.ForceResizeAug((224, 224))\n]\n\ntest_augs \u003d [\n    image.ResizeAug(224),\n    image.CenterCropAug((224, 224))\n]\n\n\ndef transform(data, label, augs):\n    data \u003d data.astype(\u0027float32\u0027)\n    for aug in augs:\n        data \u003d aug(data)\n    data \u003d nd.transpose(data, (2,0,1))\n    return data, nd.array([label]).asscalar().astype(\u0027float32\u0027)\n\ncategory_to_idx \u003d {\u0027breaker_box\u0027: 0, \u0027furnace\u0027: 1, \u0027hot_water_tank\u0027: 2, \u0027oil_tank\u0027: 3, \u0027pillar\u0027: 4, \u0027smoke_detector\u0027: 5, \u0027stairs\u0027: 6, \u0027sump_pump\u0027: 7, \u0027wall\u0027: 8, \u0027washer\u0027: 9, \u0027water_softener\u0027: 10}\n#print(\"Supported labels: \" + str([a for a in category_to_idx.keys()]))\n\ndef get_label_and_prod(out):\n  labels \u003d [a for a in category_to_idx.keys()]\n  pred \u003d int(nd.argmax(out, axis\u003d1).asscalar())\n  maxval \u003d nd.max(out, axis\u003d1).asscalar()\n\n  return pred, labels[pred], maxval\n\ndef predict_class(net, fname, epoch, validation_set, outfile):\n  with open(\"/data/household/demo/before/\" + fname, \u0027rb\u0027) as f:\n    img \u003d image.imdecode(f.read())\n    data, _ \u003d transform(img, -1, test_augs)\n    \n    data \u003d data.expand_dims(axis\u003d0)\n    data \u003d color_normalize(data/255,\n      mean \u003d nd.array([0.485, 0.456, 0.406]).reshape((1,3,1,1)),\n      std \u003d nd.array([0.229, 0.224, 0.225]).reshape((1,3,1,1)))\n    \n    out \u003d net(data.as_in_context(mxnet.cpu()))\n    pred, label, maxval \u003d get_label_and_prod(out)\n    \n    correct \u003d 0\n    \n    if label in validation_set[fname]:\n        correct \u003d 1\n    \n    print(str(epoch) + \"\\t\" + fname + \"\\t\" + label + \"\\t\" + str(correct), file\u003doutfile)\n    \n\nepochs \u003d 14\n\ntrain_map \u003d {\u0027breaker_box\u0027: 0, \u0027furnace\u0027: 1, \u0027hot_water_tank\u0027: 2, \u0027oil_tank\u0027: 3, \u0027pillar\u0027: 4, \u0027smoke_detector\u0027: 5, \u0027stairs\u0027: 6, \u0027sump_pump\u0027: 7, \u0027wall\u0027: 8, \u0027washer\u0027: 9, \u0027water_softener\u0027: 10}\n\nvalidation_file \u003d open(\"/data/validation.csv\", \"r\")\nvalidation_set \u003d {}\nfor line in validation_file:\n    parts \u003d line.split(\",\")\n    file \u003d parts[0]\n    if (file not in validation_set):\n        validation_set[file] \u003d []\n        \n    validation_set[file].append(parts[1].strip())\n\noutfile \u003d open(\"/data/epoch_results.csv\", \"w\")\nprint(\"epoch\\tfilename\\tlabel\\tcorrect\", file\u003doutfile)\n\nfor epoch in range(0, epochs):\n    pretrained_net \u003d resnet50_v1(pretrained\u003dTrue)\n    epoch_net \u003d resnet50_v1(classes\u003dlen(train_map))\n    epoch_net.features \u003d pretrained_net.features\n    epoch_net.output.initialize(init.Xavier())\n \n    epoch_net.load_parameters(\u0027/data/checkpoints/%d.params\u0027 % (epoch))\n \n    for filename in sorted(os.listdir(\"/data/household/demo/before/\")):\n        if filename.endswith(\".jpg\"):\n            predict_class(epoch_net, filename, epoch, validation_set, outfile)\n    \noutfile.close()\n",
      "user": "anonymous",
      "dateUpdated": "2019-08-20 13:01:15.822",
      "config": {
        "colWidth": 12.0,
        "fontSize": 9.0,
        "enabled": true,
        "results": {
          "0": {
            "graph": {
              "mode": "multiBarChart",
              "height": 300.0,
              "optionOpen": false,
              "setting": {
                "multiBarChart": {
                  "rotate": {
                    "degree": "-45"
                  },
                  "xLabelStatus": "default"
                }
              },
              "commonSetting": {},
              "keys": [],
              "groups": [],
              "values": []
            },
            "helium": {}
          }
        },
        "editorSetting": {
          "language": "python",
          "editOnDblClick": false,
          "completionKey": "TAB",
          "completionSupport": true
        },
        "editorMode": "ace/mode/python"
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": []
      },
      "apps": [],
      "jobName": "paragraph_1566263852270_-1985417377",
      "id": "20190820-011732_13442082",
      "dateCreated": "2019-08-20 01:17:32.270",
      "dateStarted": "2019-08-20 13:01:15.838",
      "dateFinished": "2019-08-20 13:30:38.821",
      "status": "FINISHED",
      "progressUpdateIntervalMs": 500
    },
    {
      "text": "%python\nprint(\"%table\")\ne \u003d open(\"/data/epoch_results.csv\", \"r\")\n\nepoch_totals \u003d {}\nepoch_correct \u003d {}\n\nfor line in e:\n    parts \u003d line.split(\"\\t\")\n    \n    epoch \u003d parts[0]\n    \n    if epoch \u003d\u003d \"epoch\":\n        continue\n    \n    if not epoch in epoch_totals:\n        epoch_totals[epoch] \u003d 0\n        epoch_correct[epoch] \u003d 0\n \n    correct \u003d parts[3].strip()\n    \n    epoch_totals[epoch] \u003d epoch_totals[epoch] + 1\n    \n    if correct \u003d\u003d \"1\":\n        epoch_correct[epoch] \u003d epoch_correct[epoch] + 1\n\nprint(\"Epoch\\tTotal\\tRight\\tPercent\")\nfor k in epoch_totals:\n    print(k + \"\\t\" + str(epoch_totals[k]) + \"\\t\" + str(epoch_correct[k]) + \"\\t\" + str( epoch_correct[k] / epoch_totals[k]))\n\ne.close()\n",
      "user": "anonymous",
      "dateUpdated": "2019-08-20 17:34:11.960",
      "config": {
        "colWidth": 12.0,
        "fontSize": 9.0,
        "enabled": true,
        "results": {
          "0": {
            "graph": {
              "mode": "stackedAreaChart",
              "height": 300.0,
              "optionOpen": false,
              "setting": {
                "table": {
                  "tableGridState": {
                    "columns": [
                      {
                        "name": "Epoch",
                        "visible": true,
                        "width": "*",
                        "sort": {},
                        "filters": [
                          {}
                        ],
                        "pinned": ""
                      },
                      {
                        "name": "Total",
                        "visible": true,
                        "width": "*",
                        "sort": {},
                        "filters": [
                          {}
                        ],
                        "pinned": ""
                      },
                      {
                        "name": "Right",
                        "visible": true,
                        "width": "*",
                        "sort": {
                          "priority": 0.0,
                          "direction": "asc"
                        },
                        "filters": [
                          {}
                        ],
                        "pinned": ""
                      },
                      {
                        "name": "Percent",
                        "visible": true,
                        "width": "*",
                        "sort": {},
                        "filters": [
                          {}
                        ],
                        "pinned": ""
                      }
                    ],
                    "scrollFocus": {},
                    "selection": [],
                    "grouping": {
                      "grouping": [],
                      "aggregations": [],
                      "rowExpandedStates": {}
                    },
                    "treeView": {},
                    "pagination": {
                      "paginationCurrentPage": 1.0,
                      "paginationPageSize": 250.0
                    }
                  },
                  "tableColumnTypeState": {
                    "names": {
                      "Epoch": "number",
                      "Total": "number",
                      "Right": "number",
                      "Percent": "number"
                    },
                    "updated": false
                  },
                  "tableOptionSpecHash": "[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]",
                  "tableOptionValue": {
                    "useFilter": false,
                    "showPagination": false,
                    "showAggregationFooter": false
                  },
                  "updated": false,
                  "initialized": false
                },
                "stackedAreaChart": {
                  "rotate": {
                    "degree": "-45"
                  },
                  "xLabelStatus": "default"
                },
                "lineChart": {
                  "rotate": {
                    "degree": "-45"
                  },
                  "xLabelStatus": "default",
                  "forceY": true,
                  "lineWithFocus": false
                },
                "multiBarChart": {
                  "rotate": {
                    "degree": "-45"
                  },
                  "xLabelStatus": "default"
                }
              },
              "commonSetting": {},
              "keys": [
                {
                  "name": "Epoch",
                  "index": 0.0,
                  "aggr": "sum"
                }
              ],
              "groups": [],
              "values": [
                {
                  "name": "Percent",
                  "index": 3.0,
                  "aggr": "max"
                }
              ]
            },
            "helium": {}
          }
        },
        "editorSetting": {
          "language": "python",
          "editOnDblClick": false,
          "completionKey": "TAB",
          "completionSupport": true
        },
        "editorMode": "ace/mode/python"
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "TABLE",
            "data": "Epoch\tTotal\tRight\tPercent\n0\t614\t87\t0.14169381107491857\n1\t614\t86\t0.14006514657980457\n2\t614\t101\t0.16449511400651465\n3\t614\t102\t0.16612377850162866\n4\t614\t151\t0.24592833876221498\n5\t614\t142\t0.23127035830618892\n6\t614\t119\t0.19381107491856678\n7\t614\t165\t0.2687296416938111\n8\t614\t153\t0.249185667752443\n9\t614\t126\t0.20521172638436483\n10\t614\t120\t0.19543973941368079\n11\t614\t142\t0.23127035830618892\n12\t614\t124\t0.20195439739413681\n13\t614\t95\t0.15472312703583063\n"
          }
        ]
      },
      "apps": [],
      "jobName": "paragraph_1566269409122_-442093024",
      "id": "20190820-025009_1289822595",
      "dateCreated": "2019-08-20 02:50:09.122",
      "dateStarted": "2019-08-20 17:32:58.480",
      "dateFinished": "2019-08-20 17:32:58.531",
      "status": "FINISHED",
      "progressUpdateIntervalMs": 500
    },
    {
      "text": "%python\n",
      "user": "anonymous",
      "dateUpdated": "2019-08-20 02:44:15.151",
      "config": {},
      "settings": {
        "params": {},
        "forms": {}
      },
      "apps": [],
      "jobName": "paragraph_1566269055150_-1103429866",
      "id": "20190820-024415_1486326900",
      "dateCreated": "2019-08-20 02:44:15.150",
      "status": "READY",
      "progressUpdateIntervalMs": 500
    }
  ],
  "name": "Frame Debugger",
  "id": "2EMJ8VQQ6",
  "noteParams": {},
  "noteForms": {},
  "angularObjects": {
    "python:shared_process": [],
    "spark:shared_process": []
  },
  "config": {
    "isZeppelinNotebookCronEnable": false
  },
  "info": {}
}